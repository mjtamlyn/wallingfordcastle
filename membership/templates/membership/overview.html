{% extends 'base.html' %}

{% block content %}
<h2>Members</h2>
<p>Monthly charge: £{{ monthly_fee }}</p>
<!-- TODO table styling -->
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Age</th>
            <th>Membership</th>
            <th>ArcheryGB number</th>
            <th>Monthly charge</th>
            <th>Paid until</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for member in members %}
        <tr>
            <td>{{ member.name }}</td>
            <td>{{ member.get_age_display }} {% if member.date_of_birth %}({{ member.date_of_birth }}){% endif %}</td>
            <td>{{ member.get_membership_type_display }}</td>
            <td>{{ member.agb_number|default:"Unknown" }}</td>
            <td>£{{ member.plan_cost }}</td>
            <td>{{ member.paid_until|default:"Not paid" }}</td> <!-- TODO Payment received hook -->
            <td>
                <a href="{% url 'membership:member-update' member_id=member.pk %}">Edit details</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% if user.customer_id %}
<h2>Update your payment details</h2>
{% else %}
<h2>Add your payment details</h2>
{% endif %}
<form action="{% url 'membership:payment-details' %}" method="POST">
    {% csrf_token %}
    <script
        src="https://checkout.stripe.com/checkout.js" class="stripe-button"
        data-key="{{ STRIPE_KEY }}"
        data-email="{{ user.email }}"
        data-currency="GBP"
        data-amount="{{ monthly_fee }}00"
        data-name="Wallingford Castle Archers"
        data-description="Club Membership"
        data-locale="auto">
    </script>
</form>
<p><small>
Payments are processed securely using Stripe. Wallingford Castle Archers does
not store your credit card details. You will be billed monthly for all the
membership associated with your account. If you have any problems, please
contact the committee. Charges will be shown on your account as WALLINGFORD C.
ARCHERS.
</small></p>
{% endblock content %}
